
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>GTFSRTK documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">GTFSRTK  documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html#document-index">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-modules">main Module</a></li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="gtfsrtk-version-documentation">
<h1>GTFSRTK 6.0.2 Documentation<a class="headerlink" href="#gtfsrtk-version-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-introduction"></span><p>GTFSRTK is a tiny Python 3.5+ toolkit to process <a class="reference external" href="https://developers.google.com/transit/gtfs-realtime/reference">General Transit Feed Specification Realtime (GTFSR) data</a>.
It does some simple things like read and write Protocol Buffer or JSON feed files.
It also does some complex things like extract and combine delays into DataFrames using Pandas.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Do <code class="docutils literal notranslate"><span class="pre">pipenv</span> <span class="pre">install</span> <span class="pre">gtfsrtk</span></code>.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>See the Jupyter notebook at <code class="docutils literal notranslate"><span class="pre">ipynb/examples.ipynb</span></code>.</p>
</div>
<span id="document-modules"></span><div class="section" id="module-gtfsrtk.main">
<span id="main-module"></span><h2>main Module<a class="headerlink" href="#module-gtfsrtk.main" title="Permalink to this headline">¶</a></h2>
<p>For a definition of General Transit Feed Specification Realtime (GTFSR),
see <a class="reference external" href="https://developers.google.com/transit/gtfs-realtime/reference/">https://developers.google.com/transit/gtfs-realtime/reference/</a>.</p>
<dl class="function">
<dt id="gtfsrtk.main.build_augmented_stop_times">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">build_augmented_stop_times</code><span class="sig-paren">(</span><em>gtfsr_feeds</em>, <em>gtfs_feed</em>, <em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.build_augmented_stop_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of GTFSR feeds (FeedMessage instances), a GTFS feed
(GTFSTK Feed instance), and a date (YYYYMMDD string), return
a DataFrame of GTFS stop times for trips scheduled on the given date
and containing two extra columns, <code class="docutils literal notranslate"><span class="pre">'arrival_delay'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'departure_delay'</span></code>, which are delay values in seconds
for that stop time according to the GTFSR feeds given.</p>
<p>If no GTFSR feeds are given or if their dates don’t alight with
the given date, then the resulting delay fields will be all NaN.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.combine_delays">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">combine_delays</code><span class="sig-paren">(</span><em>delays_list</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.combine_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of DataFrames of the form output by the function
<a class="reference internal" href="#gtfsrtk.main.extract_delays" title="gtfsrtk.main.extract_delays"><code class="xref py py-func docutils literal notranslate"><span class="pre">extract_delays()</span></code></a>, combine them into a single DataFrame as
follows and return the result.
Concatenate <code class="docutils literal notranslate"><span class="pre">delays_list</span></code> and remove duplicate
[route_id, trip_id, stop_sequence]
entries by combining their non-null delay values into one entry.</p>
<p>Warning: to ensure sensible output, don’t include in <code class="docutils literal notranslate"><span class="pre">delays_list</span></code>
the same trips on different days.</p>
<p>Return an empty DataFrame if <code class="docutils literal notranslate"><span class="pre">delays_list</span></code> is empty.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.dict_to_feed">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">dict_to_feed</code><span class="sig-paren">(</span><em>feed_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.dict_to_feed" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the given dictionary to a GTFSR feed (FeedMessage instance).</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.extract_delays">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">extract_delays</code><span class="sig-paren">(</span><em>feed</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.extract_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a GTFSR feed (FeedMessage instance), extract the delays from
the feed and return a DataFrame with the columns:</p>
<ul class="simple">
<li>route_id</li>
<li>trip_id</li>
<li>stop_id</li>
<li>stop_sequence</li>
<li>arrival_delay</li>
<li>departure_delay</li>
</ul>
<p>If the feed has no trip updates, then return an empty DataFrame.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.feed_to_dict">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">feed_to_dict</code><span class="sig-paren">(</span><em>feed</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.feed_to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the given GTFSR feed (FeedMessage instance) to a dictionary.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.get_timestamp_str">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">get_timestamp_str</code><span class="sig-paren">(</span><em>feed</em>, <em>datetime_format='%Y-%m-%dT%H:%M:%S'</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.get_timestamp_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a GTFSR feed (FeedMessage instance), return the timestamp
of the feed as a date string in the given format.
Note that an empty feed has an (unformatted) timestamp of 0.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.interpolate_delays">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">interpolate_delays</code><span class="sig-paren">(</span><em>augmented_stop_times</em>, <em>dist_threshold</em>, <em>delay_threshold=3600</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.interpolate_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an augment stop times DataFrame as output by the function
<a class="reference internal" href="#gtfsrtk.main.build_augmented_stop_times" title="gtfsrtk.main.build_augmented_stop_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">build_augmented_stop_times()</span></code></a>, a distance threshold (float)
in the same units as the <code class="docutils literal notranslate"><span class="pre">'shape_dist_traveled'</span></code> column of
<code class="docutils literal notranslate"><span class="pre">augmented_stop_times</span></code>, if that column is present, and a delay
threshold (integer number of seconds), alter the delay values
of the augmented stop times as follows.</p>
<p>Drop all delays with absolute value more than <code class="docutils literal notranslate"><span class="pre">delay_threshold</span></code>
seconds.
For each trip and for each delay type (arrival delay or departure
delay) do the following.
If the trip has all null values for the delay type,
then leave the values as is.
Otherwise:</p>
<ul class="simple">
<li>If the first delay is more than <code class="docutils literal notranslate"><span class="pre">dist_threshold</span></code> distance units
from the first stop, then set the first stop delay to zero (charitably);
otherwise set the first stop delay to the first delay.</li>
<li>If the last delay is more than <code class="docutils literal notranslate"><span class="pre">dist_threshold</span></code> distance units from
the last stop, then set the last stop delay to zero (charitably);
otherwise set the last stop delay to the last delay.</li>
<li>Linearly interpolate the remaining stop delays by distance.</li>
</ul>
<p>Return the resulting DataFrame.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.read_gtfsr">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">read_gtfsr</code><span class="sig-paren">(</span><em>path</em>, <em>*</em>, <em>from_json=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.read_gtfsr" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a path (string or Path object) to a GTFSR feed file,
return the corresponding GTFS feed (FeedMessage instance).
If <code class="docutils literal notranslate"><span class="pre">from_json</span></code>, then assume the feed file is in JSON format;
otherwise, assume the feed file is in Protocol Buffer format.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.timestamp_to_str">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">timestamp_to_str</code><span class="sig-paren">(</span><em>t</em>, <em>datetime_format='%Y-%m-%dT%H:%M:%S'</em>, <em>*</em>, <em>inverse=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.timestamp_to_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a POSIX timestamp (integer) <code class="docutils literal notranslate"><span class="pre">t</span></code>,
format it as a datetime string in the given format.
If <code class="docutils literal notranslate"><span class="pre">inverse</span></code>, then do the inverse, that is, assume <code class="docutils literal notranslate"><span class="pre">t</span></code> is
a datetime string in the given format and return its corresponding
timestamp.
If <code class="docutils literal notranslate"><span class="pre">format</span> <span class="pre">is</span> <span class="pre">None</span></code>, then return <code class="docutils literal notranslate"><span class="pre">t</span></code> as a string
(if not <code class="docutils literal notranslate"><span class="pre">inverse</span></code>) or as an integer (if <code class="docutils literal notranslate"><span class="pre">inverse</span></code>) directly.</p>
</dd></dl>

<dl class="function">
<dt id="gtfsrtk.main.write_gtfsr">
<code class="descclassname">gtfsrtk.main.</code><code class="descname">write_gtfsr</code><span class="sig-paren">(</span><em>feed</em>, <em>path</em>, <em>*</em>, <em>to_json=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gtfsrtk.main.write_gtfsr" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a GTFSR feed (FeedMessage instance), write it to the given
file path (string or Path object).
If <code class="docutils literal notranslate"><span class="pre">to_json</span></code>, then save the file as JSON;
otherwise save it as Protocol Buffer.</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">GTFSRTK  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Alex Raichev.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.2.
    </div>
  </body>
</html>